<ion-content>

  <ion-list>
    <ion-button fill="outline" expand="block" button fill="outline" routerLink="/home/perfil/mis-tratamientos/agregar">
      Agregar tratamiento
      <ion-icon name="add-outline" slot="end"></ion-icon>
    </ion-button>

    <div *ngFor="let tratamiento of tratamientos$ | async">
      <ion-item lines="none" detail="false" (click)="toggleExpand(tratamiento)">
        <ion-label class="label-input">{{tratamiento.farmaco}}</ion-label>
        <ion-icon slot="end" name="chevron-down-outline" *ngIf="!tratamiento.expandido"></ion-icon>
        <ion-icon slot="end" name="chevron-up-outline" *ngIf="tratamiento.expandido"></ion-icon>
      </ion-item>

      <ion-card *ngIf="tratamiento.expandido">
        <ion-card-content>
          <ion-grid>
            <ion-row>
              <ion-col>
                <div class="form-group">
                  <ion-label class="label-input">Fármaco</ion-label>
                  <ion-input class="form-control" [(ngModel)]="tratamiento.farmaco" readonly></ion-input>
                </div>
              </ion-col>
              <ion-col>
                <div class="form-group">
                  <ion-label class="label-input">Cantidad</ion-label>
                  <ion-input class="form-control" [(ngModel)]="tratamiento.cantidad" type="number" readonly></ion-input>
                </div>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col>
                <div class="form-group">
                  <ion-label class="label-input">Unidad</ion-label>
                  <ion-input class="form-control" [(ngModel)]="tratamiento.unidad" readonly></ion-input>
                </div>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col>
                <div class="form-group">
                  <ion-label class="label-input">Indicaciones</ion-label>
                  <ion-input class="form-control" [(ngModel)]="tratamiento.indicaciones" readonly></ion-input>
                </div>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col>
                <div class="form-group">
                  <ion-label class="label-input">Padecimiento Asociado</ion-label>
                  <ion-input class="form-control" [(ngModel)]="tratamiento.padecimiento" readonly></ion-input>
                </div>
              </ion-col>
            </ion-row>
            <ion-row [hidden]="!tratamiento.imagenBase64" class="centered">
              <ion-col size="2">
                <img [src]="'data:image/jpeg;base64,' + tratamiento.imagenBase64" alt="Imagen" />
              </ion-col>
            </ion-row>
          </ion-grid>

          <ion-row>
            <ion-col>
              <ion-label>Recordatorio de tomas - {{ tratamiento.recordatorioActivo ? 'Activado' : 'Desactivado' }}</ion-label>
            </ion-col>
          </ion-row>

          <ion-grid [hidden]="!tratamiento.recordatorioActivo">

            <ion-row>
              <ion-col>
                <ion-label>Días de la semana</ion-label>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="1" *ngFor="let day of weekDays; index as i">
                <div class="checkbox-container">
                  <ion-checkbox [(ngModel)]="tratamiento.diaSemana[i]" disabled></ion-checkbox>
                  <ion-label class="checkbox-label">{{day}}</ion-label>
                </div>
              </ion-col>
            </ion-row>

            <ion-row>
              <ion-col>
                <ion-label>Horario(h):</ion-label>
              </ion-col>
            </ion-row>
            <ion-row *ngFor="let hour of tratamiento.horas">
              <ion-col>
                <ion-label>{{ ('1970-01-01T' + hour + 'Z') | date: 'HH:mm' }}</ion-label>
              </ion-col>
            </ion-row>


            <details>
              <summary>Bitacora Consumo de Medicamentos</summary>
              <ion-grid>
                <ion-row class="table-header">
                  <ion-col>
                    <ion-label>Fecha y Hora</ion-label>
                  </ion-col>
                  <ion-col>
                    <ion-label>Fármaco</ion-label>
                  </ion-col>
                </ion-row>
                <ion-row class="table-row" *ngFor="let entry of tratamiento.bitacora">
                  <ion-col>
                    <ion-label>{{entry | date:'medium'}}</ion-label>
                  </ion-col>
                  <ion-col>
                    <ion-label>{{entry}}</ion-label>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </details>

          </ion-grid>
        </ion-card-content>
      </ion-card>

    </div>
  </ion-list>
</ion-content>
