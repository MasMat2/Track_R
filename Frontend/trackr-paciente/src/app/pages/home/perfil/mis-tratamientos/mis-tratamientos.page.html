<ion-content>
  <ion-list>
    <ion-button expand="block" fill="outline" routerLink="/home/perfil/mis-tratamientos/agregar">
      Agregar tratamiento
      <ion-icon name="add-outline" slot="end"></ion-icon>
    </ion-button>

    <div *ngFor="let tratamiento of tratamientos$ | async">
      
      <ion-item lines="full" detail="false" (click)="toggleExpandido(tratamiento)">
        <ion-label class="label-input">{{tratamiento.farmaco}}</ion-label>
        <ion-img *ngIf="tratamiento.imagenBase64" [src]="'data:image/jpeg;base64,' + tratamiento.imagenBase64" class="img"></ion-img>
        <ion-icon slot="end" name="chevron-forward-outline" [hidden]="tratamiento.expandido"></ion-icon>
        <ion-icon slot="end" name="chevron-down-outline" [hidden]="!tratamiento.expandido"></ion-icon>
      </ion-item>

      <div [hidden]="!tratamiento.expandido">
        
        <ion-grid>
          <ion-row [hidden]="!tratamiento.imagenBase64" class="centered">
            <ion-col size="2">
              <img [src]="'data:image/jpeg;base64,' + tratamiento.imagenBase64" alt="Imagen" />
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col class="form-group">
              <ion-input                   
                [value]="tratamiento.farmaco"
                readonly                                          
                label="Fármaco"
                label-placement="floating"
                fill="outline"
                shape="round">
              </ion-input>
            </ion-col>
            <ion-col class="form-group">
              <ion-input                   
                [value]="tratamiento.cantidad"
                type="number"
                readonly                                          
                label="Cantidad"
                label-placement="floating"
                fill="outline"
                shape="round">
              </ion-input>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col class="form-group">
              <ion-input                   
                [value]="tratamiento.unidad"
                readonly                                          
                label="Unidad"
                label-placement="floating"
                fill="outline"
                shape="round">
              </ion-input>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col class="form-group">
              <ion-input                   
                [value]="tratamiento.indicaciones"
                readonly                                     
                label="Indicaciones"
                label-placement="floating"
                fill="outline"
                shape="round">
              </ion-input>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col class="form-group">
              <ion-input                   
                [value]="tratamiento.padecimiento"
                readonly                                     
                label="Padecimiento Asociado"
                label-placement="floating"
                fill="outline"
                shape="round">
              </ion-input>
            </ion-col>
          </ion-row>

          
        </ion-grid>

        <ion-row>
          <ion-col>
            <ion-label>Recordatorio de tomas - {{ tratamiento.recordatorioActivo ? 'Activado' : 'Desactivado'}}</ion-label>
          </ion-col>
        </ion-row>

        <ion-grid [hidden]="!tratamiento.recordatorioActivo">

          <ion-row>
            <ion-col>
              <ion-label>Días de la semana</ion-label>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col *ngFor="let day of weekDays; index as i">
              <div class="checkbox-container">
                <ion-checkbox [checked]="tratamiento.diaSemana[i]" disabled></ion-checkbox>
                <ion-label class="checkbox-label">{{day}}</ion-label>
              </div>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col>
              <ion-label>Horario(h):</ion-label>
            </ion-col>
          </ion-row>
          <ion-row *ngFor="let hour of tratamiento.horas">
            <ion-col>
              <ion-label>{{ ('1970-01-01T' + hour) | date: 'HH:mm' }}</ion-label>
            </ion-col>
          </ion-row>


          <details>
            <summary>Bitacora Consumo de Medicamentos</summary>
            <ion-grid>

              <ion-row class="table-header">
                <ion-col>
                  <ion-label>Fecha y Hora</ion-label>
                </ion-col>
                <ion-col>
                  <ion-label>Fármaco</ion-label>
                </ion-col>
              </ion-row>

              <ion-row class="table-row" *ngFor="let entry of tratamiento.bitacora">
                <ion-col>
                  <ion-label>{{entry | date: 'dd/MM/yy - HH:mm' }} h</ion-label>
                </ion-col>
                <ion-col>
                  <ion-label>{{ tratamiento.farmaco }}</ion-label>
                </ion-col>
              </ion-row>

            </ion-grid>
          </details>

        </ion-grid>

      </div>

    </div>
  </ion-list>
</ion-content>
