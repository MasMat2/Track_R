"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2605],{2605:(L,_,n)=>{n.r(_),n.d(_,{default:()=>D});var s=n(5861),h=n(9149),M=n(433),u=n(6895),i=n(1571),v=n(4384);let f=(()=>{var o;class d{constructor(){}}return(o=d).\u0275fac=function(t){return new(t||o)},o.\u0275prov=i.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),d})();var S=n(1481),E=n(4602),A=n(4273),y=n(9160);const D=[{path:"",children:[{path:"answer-call/:meet-name",component:(()=>{var o;class d{constructor(t,e,a,c){var g=this;this.orientationService=t,this.route=e,this.router=a,this.meta=c,this.domain="meet.jit.si",this.isAudioMuted=!1,this.isVideoMuted=!1,this.iniciarWebCam=(0,s.Z)(function*(){g.localStream=yield navigator.mediaDevices.getUserMedia({video:!0,audio:!0})}),this.handleClose=()=>{console.log("handleClose")},this.handleParticipantLeft=function(){var r=(0,s.Z)(function*(l){console.log("handleParticipantLeft",l)});return function(l){return r.apply(this,arguments)}}(),this.handleParticipantJoined=function(){var r=(0,s.Z)(function*(l){console.log("handleParticipantJoined",l),yield g.getParticipants()});return function(l){return r.apply(this,arguments)}}(),this.handleVideoConferenceJoined=function(){var r=(0,s.Z)(function*(l){console.log("handleVideoConferenceJoined",l),yield g.getParticipants()});return function(l){return r.apply(this,arguments)}}(),this.handleVideoConferenceLeft=()=>{console.log("handleVideoConferenceLeft")},this.handleMuteStatus=r=>{console.log("handleMuteStatus",r)},this.handleVideoStatus=r=>{console.log("handleVideoStatus",r)}}ngOnInit(){this.route.paramMap.subscribe(e=>{this.meetName=e.get("meet-name")}),this.orientationService.lockLandscape(),this.iniciarWebCam(),this.meta.addTag({name:"Content-Security-Policy",content:"default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content:;"}),this.answerMeet()}answerMeet(){const t={roomName:this.meetName,width:900,height:500,configOverwrite:{prejoinPageEnabled:!1},interfaceConfigOverwrite:{},parentNode:document.querySelector("#jitsi-answer-call-iframe"),userInfo:{displayName:"Medico-Trackr"}};this.api=new JitsiMeetExternalAPI(this.domain,t),this.api.addEventListeners({readyToClose:this.handleClose,participantLeft:this.handleParticipantLeft,participantJoined:this.handleParticipantJoined,videoConferenceJoined:this.handleVideoConferenceJoined,videoConferenceLeft:this.handleVideoConferenceLeft,audioMuteStatusChanged:this.handleMuteStatus,videoMuteStatusChanged:this.handleVideoStatus})}executeCommand(t){if(this.api.executeCommand(t),"hangup"==t)return this.localStream.getTracks().forEach(e=>e.stop()),this.router.navigate(["/home"]),this.orientationService.lockPortrait(),this.api.dispose(),void this.api.remove();"toggleAudio"==t&&(this.isAudioMuted=!this.isAudioMuted),"toggleVideo"==t&&(this.isVideoMuted=!this.isVideoMuted)}getParticipants(){return new Promise((t,e)=>{setTimeout(()=>{t(this.api.getParticipantsInfo())},500)})}}return(o=d).\u0275fac=function(t){return new(t||o)(i.Y36(E.H),i.Y36(v.gz),i.Y36(v.F0),i.Y36(S.h_))},o.\u0275cmp=i.Xpm({type:o,selectors:[["app-answer-meet"]],standalone:!0,features:[i.jDz],decls:3,vars:0,consts:[["id","jitsi-answer-call-iframe"],[1,"item-center"],["aria-hidden","true","title","Leave",1,"fas","fa-phone-slash","fa-2x","red-color","hangup-btn",3,"click"]],template:function(t,e){1&t&&(i.TgZ(0,"div",0)(1,"div",1)(2,"i",2),i.NdJ("click",function(){return e.executeCommand("hangup")}),i.qZA()()())},dependencies:[h.Pc,u.ez,M.u5],styles:['@charset "UTF-8";#jitsi-answer-call-iframe[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;position:relative}.hangup-btn[_ngcontent-%COMP%]{position:absolute;bottom:2%;padding:0;text-align:end;direction:revert;height:10%;color:#fff;left:2%}']}),d})()},{path:"create-call/:id-chat",component:(()=>{var o;class d{constructor(t,e,a,c,g,r,l){var P=this;this.router=t,this.dataJitsiService=e,this.meta=a,this.orientationService=c,this.mensajeHubService=g,this.chatMensajeHubServiceService=r,this.route=l,this.chats=[],this.domain="meet.jit.si",this.isAudioMuted=!1,this.isVideoMuted=!1,this.iniciarWebCam=(0,s.Z)(function*(){P.localStream=yield navigator.mediaDevices.getUserMedia({video:!0,audio:!0})}),this.handleClose=()=>{console.log("handleClose"),this.orientationService.lockPortrait()},this.handleParticipantLeft=function(){var p=(0,s.Z)(function*(C){console.log("handleParticipantLeft",C),yield P.getParticipants()});return function(C){return p.apply(this,arguments)}}(),this.handleParticipantJoined=function(){var p=(0,s.Z)(function*(C){console.log("handleParticipantJoined",C),yield P.getParticipants()});return function(C){return p.apply(this,arguments)}}(),this.handleVideoConferenceJoined=function(){var p=(0,s.Z)(function*(C){console.log("handleVideoConferenceJoined",C),yield P.getParticipants()});return function(C){return p.apply(this,arguments)}}(),this.handleVideoConferenceLeft=()=>{console.log("handleVideoConferenceLeft"),this.router.navigate(["/home"])},this.handleMuteStatus=p=>{console.log("handleMuteStatus",p)},this.handleVideoStatus=p=>{console.log("handleVideoStatus",p)}}ngOnInit(){this.route.paramMap.subscribe(e=>{this.idChat=e.get("id-chat")}),this.orientationService.lockLandscape(),this.iniciarWebCam(),this.meta.addTag({name:"Content-Security-Policy",content:"default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content:;"}),this.createNewRoom()}obtenerChats(){this.chatMensajeHubServiceService.iniciarConexion(),this.chats$=this.chatMensajeHubServiceService.chat$,this.chats$.subscribe(t=>{this.chats=t})}obtenerMensajes(){this.mensajeHubService.iniciarConexion(),this.mensajes$=this.mensajeHubService.chatMensaje$,this.mensajes$.subscribe(t=>{this.mensajes=t,console.log(this.mensajes)})}createNewRoom(){const t="trackr-"+this.idChat+"-"+Math.floor(1e4*Math.random());this.mandarMensajeLlamada("\u{1f4de} Te espero la sala "+t),window.location.assign(`intent://${this.domain}/${t}#Intent;scheme=org.jitsi.meet;package=org.jitsi.meet;end`);const c={roomName:t,width:800,height:500,configOverwrite:{prejoinPageEnabled:!1},interfaceConfigOverwrite:{},parentNode:document.querySelector("#jitsi-new-meet-iframe"),userInfo:{displayName:"Trackr-user"}};this.roomApi=new JitsiMeetExternalAPI(this.domain,c),this.roomApi.addEventListeners({readyToClose:this.handleClose,participantLeft:this.handleParticipantLeft,participantJoined:this.handleParticipantJoined,videoConferenceJoined:this.handleVideoConferenceJoined,videoConferenceLeft:this.handleVideoConferenceLeft,audioMuteStatusChanged:this.handleMuteStatus,videoMuteStatusChanged:this.handleVideoStatus}),console.log("Nueva sala creada:",t)}mandarMensajeLlamada(t){console.log("id chat mensaje "+this.idChat);let e={fecha:new Date,idChat:parseInt(this.idChat),mensaje:t,idPersona:5333,archivo:"",idArchivo:0};this.mensajeHubService.enviarMensaje(e),console.log("mandarMensajeLlamada method msg: "+t)}getParticipants(){return new Promise((t,e)=>{setTimeout(()=>{t(this.roomApi.getParticipantsInfo())},500)})}executeCommand(t){if(this.roomApi.executeCommand(t),"hangup"==t)return this.localStream.getTracks().forEach(e=>e.stop()),this.router.navigate(["/home"]),this.orientationService.lockPortrait(),this.roomApi.dispose(),void this.roomApi.remove();"toggleAudio"==t&&(this.isAudioMuted=!this.isAudioMuted),"toggleVideo"==t&&(this.isVideoMuted=!this.isVideoMuted)}}return(o=d).\u0275fac=function(t){return new(t||o)(i.Y36(v.F0),i.Y36(f),i.Y36(S.h_),i.Y36(E.H),i.Y36(A.U),i.Y36(y.L),i.Y36(v.gz))},o.\u0275cmp=i.Xpm({type:o,selectors:[["app-create-jitsi-meet"]],standalone:!0,features:[i.jDz],decls:3,vars:0,consts:[["id","jitsi-new-meet-iframe"],[1,"item-center"],["aria-hidden","true","title","Leave",1,"fas","fa-phone-slash","fa-2x","red-color","hangup-btn",3,"click"]],template:function(t,e){1&t&&(i._UZ(0,"div",0),i.TgZ(1,"div",1)(2,"i",2),i.NdJ("click",function(){return e.executeCommand("hangup")}),i.qZA()())},dependencies:[h.Pc,u.ez,M.u5],styles:['@charset "UTF-8";#jitsi-new-meet-iframe[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}.hangup-btn[_ngcontent-%COMP%]{position:absolute;bottom:0;padding:0;text-align:end;direction:revert;height:10%}']}),d})()}]}]},9160:(L,_,n)=>{n.d(_,{L:()=>o});var s=n(5861),h=n(9856),M=n(5079),u=n(1651),i=n(162),v=n(1135),f=n(9300),S=n(5698),E=n(7414),A=n(262),y=n(2340),j=n(1571),O=n(2644),D=n(3369);let o=(()=>{var d;class m{constructor(e,a){this.ChatPersonaService=e,this.authService=a,this.connectionStatus=new v.X(h.A.Disconnected),this.chatSubject=new v.X([]),this.chat$=this.chatSubject.asObservable(),this.endpoint="hub/chat",this.iniciarConexion()}iniciarConexion(){var e=this;return(0,s.Z)(function*(){const a=yield e.authService.obtenerToken();if(!a)return;const c=`${y.N.urlBackend}${e.endpoint}`,g={accessTokenFactory:()=>a,transport:M.n.LongPolling};e.connection=(new u.s).configureLogging(i.i.Debug).withUrl(c,g).build(),e.connection.on("NuevoChat",(r,l)=>e.onNuevoChat(r,l)),e.connection.on("NuevaConexion",r=>e.onNuevaConexion(r)),e.connection.on("CargarChats",r=>e.onCargarChats(r)),e.connectionStatus.next(h.A.Connecting),yield e.connection.start()})()}detenerConexion(){var e=this;return(0,s.Z)(function*(){e.connectionStatus.next(h.A.Disconnecting),yield e.connection.stop(),e.chatSubject.next([]),e.connectionStatus.next(h.A.Disconnected)})()}obtenerNotificaciones(){return this.chatSubject.value}onNuevoChat(e,a){var c=this;return(0,s.Z)(function*(){e.fecha=new Date,c.chatSubject.value.push(e)})()}onNuevaConexion(e){for(const a of e)a.fecha=new Date(a.fecha);this.chatSubject.next(e)}onCargarChats(e){this.chatSubject.next(e)}ensureConnection(){var e=this;return(0,s.Z)(function*(){if(e.connection.state!==h.A.Connected){if(e.connection.state===h.A.Disconnected||e.connection.state===h.A.Disconnecting)throw new Error("No se ha iniciado la conexion con el Hub de Notificaciones");(e.connection.state===h.A.Connecting||e.connection.state===h.A.Reconnecting)&&e.connectionStatus.asObservable().pipe((0,f.h)(c=>c===h.A.Connected),(0,S.q)(1),(0,E.V)(1e4),(0,A.K)(()=>{throw new Error("No se pudo establecer la conexi\xf3n con el Hub de Notificaciones")}))}})()}agregarChat(e,a){var c=this;return(0,s.Z)(function*(){yield c.ensureConnection(),yield c.connection.invoke("NuevoChat",e,a)})()}abandonarChat(e){let a=this.chatSubject.value;a=a.filter(c=>c.idChat!=e),this.chatSubject.next(a)}}return(d=m).\u0275fac=function(e){return new(e||d)(j.LFG(O.R),j.LFG(D.e))},d.\u0275prov=j.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),m})()},2644:(L,_,n)=>{n.d(_,{R:()=>M});var s=n(1571),h=n(529);let M=(()=>{var u;class i{constructor(f){this.http=f,this.dataUrl="ChatPersona/"}agregarPersonas(f){return this.http.post(this.dataUrl,f)}obtenerIdUsuario(){return this.http.get(`${this.dataUrl}IdUsuario`)}obtenerIdPacientesPadecimiento(f){return this.http.get(`${this.dataUrl}Padecimiento/${f}`)}}return(u=i).\u0275fac=function(f){return new(f||u)(s.LFG(h.eN))},u.\u0275prov=s.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),i})()}}]);